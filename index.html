<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>WebGPU Brick Renderer</title>
    <style>
      canvas {
        width: 512px;
        height: 512px;
      }
    </style>
  </head>
  <body>
    <canvas width="512" height="512"></canvas>
    <form>
      <label for="rotateX">Rotate X</label>
      <input
        type="range"
        id="rotateX"
        name="rotateX"
        value="0"
        min="0"
        max="360"
      />
      <label for="rotateY">Rotate Y</label>
      <input
        type="range"
        id="rotateY"
        name="rotateY"
        value="0"
        min="0"
        max="360"
      />
      <label for="rotateZ">Rotate Z</label>
      <input
        type="range"
        id="rotateZ"
        name="rotateZ"
        value="0"
        min="0"
        max="360"
      />

      <label for="scale">Scale</label>
      <input
        type="range"
        id="rotateZ"
        name="scale"
        value="1"
        min="0"
        max="2"
        step="0.1"
      />

      <button type="reset">Reset</button>
    </form>
    <script type="module">
      import { run } from "./index.js";

      const canvas = document.querySelector("canvas");

      // Smoother lines on high resolution displays
      const devicePixelRatio = window.devicePixelRatio;
      canvas.width = canvas.clientWidth * devicePixelRatio;
      canvas.height = canvas.clientHeight * devicePixelRatio;

      const form = document.querySelector("form");

      let animationFrame = -1;

      async function update() {
        cancelAnimationFrame(animationFrame);

        animationFrame = requestAnimationFrame(async function () {
          const data = new FormData(form);

          const transforms = {
            rotateX: (data.get("rotateX") * Math.PI) / 180,
            rotateY: (data.get("rotateY") * Math.PI) / 180,
            rotateZ: (data.get("rotateZ") * Math.PI) / 180,
            scale: Number.parseFloat(data.get("scale")),
          };
          await run(canvas, transforms);
        });
      }

      form.addEventListener("input", update);
      form.addEventListener("reset", update);

      await update();
    </script>
  </body>
</html>
